[{
  "history_id" : "mfqyx4ighe3",
  "history_input" : null,
  "history_output" : "/Users/joe/gw-workspace/temp/idjcvRcyvRGH4R217cUR64p5wb.tar is not a regular file or directory",
  "history_begin_time" : 1645977435859,
  "history_end_time" : 1645977436331,
  "history_notes" : null,
  "history_process" : "78vedq",
  "host_id" : "je29f6",
  "indicator" : "Failed"
},{
  "history_id" : "886ud6vxi5e",
  "history_input" : "# Create LSTM model\n\nprint(\"Create LSTM\")\n\n",
  "history_output" : "rm: cannot remove '/home/zsun/idjcvRcyvRGH4R217cUR64p5wb.tar': No such file or directory\nCreate LSTM\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_associate_station_grid_cell.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/exploratory_data_analysis.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_cloudfree_fast.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_terrainFeatures.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_kenya_non_crop.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/text_to_csv_2020.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/GetEmissionsData.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_integration.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/ml_airnow_20.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/TrainModel_LSTM.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/scripts_export.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/test123.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_gee_sentinel1_station_only.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_config.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/SVR Model.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/snowex_nsidc_search.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_region.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/text_to_csv_2021.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/model_test.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/prepare_training_dataset.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_processors_base.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_base.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_base.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_sentinel2.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_gee_sentinel2.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/generate_snow_map.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/pre_processing.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_cloudfree_cloudfree.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/testpython2.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/Random Forest Model.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/snowex_nsidc_download_api.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/scripts_process.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_gee_modis.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_analysis.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/snow_rf_train.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/service_prediction.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/read_sentinel_1.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/prediction_autokeras.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/model_train_validate.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_gee_modis_station_only.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_modis.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/ml_airnow_21.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/data_gee_sentinel1.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/prediction_xgboost.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_cloudfree_constants.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_exporters_sentinel_cloudfree_utils.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb/src_processors_pv_kenya.py': No such file or directory\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb': No such file or directory\n",
  "history_begin_time" : 1645977432490,
  "history_end_time" : 1645977433844,
  "history_notes" : null,
  "history_process" : "mxpyqt",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "7hl7avwis4f",
  "history_input" : "# Random Forest model creation and save to file\n\nfrom sklearn.ensemble import RandomForestRegressor\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn import metrics \nfrom sklearn import tree\nimport joblib\nimport os\nfrom pathlib import Path\nimport json\nimport geopandas as gpd\nimport geojson\nimport os.path\nimport math\nfrom sklearn.model_selection import RandomizedSearchCV\n\n#pd.set_option('display.max_columns', None)\n\n# read the grid geometry file\nhomedir = os.path.expanduser('~')\nprint(homedir)\ngithub_dir = f\"{homedir}/Documents/GitHub/SnowCast\"\nmodis_ready_file = f\"{github_dir}/data/ready_for_training/modis_train_ready.csv\"\nmodis_ready_pd = pd.read_csv(modis_ready_file, header=0, index_col=0)\n\npd_to_clean = modis_ready_pd[[\"year\", \"m\", \"doy\", \"ndsi\", \"swe\"]].dropna()\n\nall_features = pd_to_clean[[\"year\", \"m\", \"doy\", \"ndsi\"]].to_numpy()\nall_labels = pd_to_clean[[\"swe\"]].to_numpy().ravel()\n\ntrain_features, test_features, train_labels, test_labels = train_test_split(all_features, all_labels, test_size=0.20, random_state=42)\n\nprint(train_features.shape)\nprint(train_labels.shape)\nprint(test_features.shape)\nprint(test_labels.shape)\n\nprint(\"==> create random forest model\")\n\n# Number of trees in random forest\nn_estimators = [int(x) for x in np.linspace(start = 200, stop = 2000, num = 10)]\n# Number of features to consider at every split\nmax_features = ['auto', 'sqrt']\n# Maximum number of levels in tree\nmax_depth = [int(x) for x in np.linspace(10, 110, num = 11)]\nmax_depth.append(None)\n# Minimum number of samples required to split a node\nmin_samples_split = [2, 5, 10]\n# Minimum number of samples required at each leaf node\nmin_samples_leaf = [1, 2, 4]\n# Method of selecting samples for training each tree\nbootstrap = [True, False]\n# Create the random grid\nrandom_grid = {'n_estimators': n_estimators,\n               'max_features': max_features,\n               'max_depth': max_depth,\n               'min_samples_split': min_samples_split,\n               'min_samples_leaf': min_samples_leaf,\n               'bootstrap': bootstrap}\nprint(random_grid)\n\nrandomForestregModel = RandomForestRegressor()\n# Random search of parameters, using 3 fold cross validation, \n# search across 100 different combinations, and use all available cores\nrf_random = RandomizedSearchCV(estimator = randomForestregModel, param_distributions = random_grid, n_iter = 100, cv = 3, verbose=2, random_state=42, n_jobs = -1)\n\n# Fit the random search model\nrf_random.fit(train_features, train_labels)\n\nprint(\"rf_random.best_params_: \", rf_random.best_params_)\n\ndef evaluate(model, test_features, y_test, model_name):\n    y_predicted = model.predict(test_features)\n    mae = metrics.mean_absolute_error(y_test, y_predicted)\n    mse = metrics.mean_squared_error(y_test, y_predicted)\n    r2 = metrics.r2_score(y_test, y_predicted)\n    rmse = math.sqrt(mse)\n\n    print(\"The model performance for testing set\")\n    print(\"--------------------------------------\")\n    print('MAE is {}'.format(mae))\n    print('MSE is {}'.format(mse))\n    print('R2 score is {}'.format(r2))\n    print('RMSE is {}'.format(rmse))\n    \n    return r2\n\nbase_model = RandomForestRegressor(n_estimators = 10, random_state = 42)\nbase_model.fit(train_features, train_labels)\nbase_accuracy = evaluate(base_model, test_features, test_labels, \"Base Model\")\n\nbest_random = rf_random.best_estimator_\nrandom_accuracy = evaluate(best_random, test_features, test_labels, \"Optimized\")\n\nprint('Improvement of {:0.2f}%.'.format( 100 * (random_accuracy - base_accuracy) / base_accuracy))\n\nos.makedirs(f\"{github_dir}/model/\", exist_ok=True)\n# save\njoblib.dump(base_model, f\"{github_dir}/model/wormhole_random_forest_basic_v2.joblib\")\njoblib.dump(best_random, f\"{github_dir}/model/wormhole_random_forest_v2.joblib\")\nprint(\"wormhole_random_forest is saved to file\")\n",
  "history_output" : "chmod: cannot access 'data_gee_modis_real_time.py': No such file or directory\nchmod: cannot access 'model_comparison.py': No such file or directory\nTraceback (most recent call last):\n  File \"model_creation_rf.py\", line 3, in <module>\nModuleNotFoundError: No module named 'sklearn'\nError in sys.excepthook:\nTraceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/apport_python_hook.py\", line 76, in apport_excepthook\n    binary = os.path.realpath(os.path.join(os.getcwd(), sys.argv[0]))\nFileNotFoundError: [Errno 2] No such file or directory\n\nOriginal exception was:\nTraceback (most recent call last):\n  File \"model_creation_rf.py\", line 3, in <module>\nModuleNotFoundError: No module named 'sklearn'\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb': No such file or directory\n",
  "history_begin_time" : 1645977432495,
  "history_end_time" : 1645977434908,
  "history_notes" : null,
  "history_process" : "c2xkhz",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "5azrtox1ieh",
  "history_input" : "# GhostNet\n\nprint(\"Create GhostNet\")\n\n",
  "history_output" : "rm: cannot remove '/home/zsun/idjcvRcyvRGH4R217cUR64p5wb.tar': No such file or directory\nCreate GhostNet\n",
  "history_begin_time" : 1645977432490,
  "history_end_time" : 1645977433837,
  "history_notes" : null,
  "history_process" : "rauqsh",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "3jhqxaa1odh",
  "history_input" : "# Find the best model\n\n",
  "history_output" : "Traceback (most recent call last):\n  File \"model_comparison.py\", line 2, in <module>\n    import pandas as pd\nModuleNotFoundError: No module named 'pandas'\n",
  "history_begin_time" : 1645977443529,
  "history_end_time" : 1645977444823,
  "history_notes" : null,
  "history_process" : "mi3e5n",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "1trl89bs22f",
  "history_input" : "# Integrate all the datasets into one training dataset\nimport json\nimport pandas as pd\nimport ee\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport os\nimport geopandas as gpd\nimport geojson\nimport numpy as np\nimport os.path\nimport math\nfrom datetime import datetime\n\n\nprint(\"integrating datasets into one dataset\")\n#pd.set_option('display.max_columns', None)\n\n# read the grid geometry file\nhomedir = os.path.expanduser('~')\nprint(homedir)\ngithub_dir = f\"{homedir}/Documents/GitHub/SnowCast\"\n# read grid cell\ngridcells_file = f\"{github_dir}/data/snowcast_provided/grid_cells.geojson\"\nmodel_dir = f\"{github_dir}/model/\"\ntraining_feature_file = f\"{github_dir}/data/snowcast_provided/ground_measures_train_features.csv\"\ntesting_feature_file = f\"{github_dir}/data/snowcast_provided/ground_measures_test_features.csv\"\ntrain_labels_file = f\"{github_dir}/data/snowcast_provided/train_labels.csv\"\nground_measure_metadata_file = f\"{github_dir}/data/snowcast_provided/ground_measures_metadata.csv\"\nstation_cell_mapper_file = f\"{github_dir}/data/ready_for_training/station_cell_mapping.csv\"\n\n#example_mod_file = f\"{github_dir}/data/modis/mod10a1_ndsi_f191fe19-0e81-4bc9-9980-29738a05a49b.csv\"\n\n\ntraining_feature_pd = pd.read_csv(training_feature_file, header=0, index_col=0)\ntesting_feature_pd = pd.read_csv(testing_feature_file, header=0, index_col=0)\ntrain_labels_pd = pd.read_csv(train_labels_file, header=0, index_col=0)\n#print(training_feature_pd.head())\n\nstation_cell_mapper_pd = pd.read_csv(station_cell_mapper_file, header=0, index_col=0)\n#print(station_cell_mapper_pd.head())\n\n#example_mod_pd = pd.read_csv(example_mod_file, header=0, index_col=0)\n#print(example_mod_pd.shape)\n\n\ndef integrate_modis():\n  \"\"\"\n  Integrate all MODIS data into mod_all.csv\n  \"\"\"\n  dates = pd.date_range(start='1/1/2013', end='12/31/2021', freq='D').astype(str)\n  mod_all_df = pd.DataFrame(columns=[\"date\"])\n  mod_all_df['date'] = dates\n  all_mod_file = f\"{github_dir}/data/ready_for_training/modis_all.csv\"\n  #print(mod_all_df.head())\n  for ind in station_cell_mapper_pd.index:\n    current_cell_id = station_cell_mapper_pd[\"cell_id\"][ind]\n    print(current_cell_id)\n    mod_single_file = f\"{github_dir}/data/modis/mod10a1_ndsi_{current_cell_id}.csv\"\n    if os.path.isfile(mod_single_file):\n      mod_single_pd = pd.read_csv(mod_single_file, header=0)\n      mod_single_pd = mod_single_pd[[\"date\", \"mod10a1_ndsi\"]]\n      mod_single_pd = mod_single_pd.rename(columns={\"mod10a1_ndsi\": current_cell_id})\n      mod_single_pd['date'] = pd.to_datetime(mod_single_pd['date']).astype(str)\n      print(mod_all_df.shape)\n      mod_all_df = pd.merge(mod_all_df, mod_single_pd, how='left', on=\"date\")\n  mod_all_df.to_csv(all_mod_file)\n\n  \ndef integrate_sentinel1():\n  \"\"\"\n  Integrate all Sentinel 1 data into sentinel1_all.csv\n  \"\"\"\n  dates = pd.date_range(start='1/1/2013', end='12/31/2021', freq='D').astype(str)\n  sentinel1_all_df = pd.DataFrame(columns=[\"date\"])\n  sentinel1_all_df['date'] = dates\n  #print(mod_all_df.head())\n  all_sentinel1_file = f\"{github_dir}/data/ready_for_training/sentinel1_all.csv\"\n\n  def getDateStr(x):\n    return x.split(\" \")[0]\n\n  for ind in station_cell_mapper_pd.index:\n    current_cell_id = station_cell_mapper_pd[\"cell_id\"][ind]\n    print(current_cell_id)\n    sentinel1_single_file = f\"{github_dir}/data/sentinel1/s1_grd_vv_{current_cell_id}.csv\"\n    if os.path.isfile(sentinel1_single_file) and current_cell_id not in sentinel1_all_df :\n      sentinel1_single_pd = pd.read_csv(sentinel1_single_file, header=0)\n      sentinel1_single_pd = sentinel1_single_pd[[\"date\", \"s1_grd_vv\"]]\n      sentinel1_single_pd = sentinel1_single_pd.rename(columns={\"s1_grd_vv\": current_cell_id})\n      #sentinel1_single_pd['date'] = sentinel1_single_pd['date'].astype('datetime64[ns]')\n      sentinel1_single_pd['date'] = pd.to_datetime(sentinel1_single_pd['date']).dt.round(\"D\").astype(str)\n      print(\"sentinel1_single_pd: \", sentinel1_single_pd.head())\n      print(\"sentinel1_single_pd check value: \", sentinel1_single_pd[sentinel1_single_pd[\"date\"]==\"2015-04-01\"])\n      sentinel1_single_pd = sentinel1_single_pd.drop_duplicates(subset=['date'], keep='first') # this will remove all the other values of the same day\n      \n      sentinel1_all_df = pd.merge(sentinel1_all_df, sentinel1_single_pd, how='left', on=\"date\")\n      print(\"sentinel1_all_df check value: \", sentinel1_all_df[sentinel1_all_df[\"date\"]==\"2015-04-01\"])\n      print(\"sentinel1_all_df: \", sentinel1_all_df.shape)\n      \n\n  print(sentinel1_all_df.shape)\n  sentinel1_all_df.to_csv(all_sentinel1_file)\n\ndef prepare_training_csv():\n  \"\"\"\n  MOD model:\n    input columns: [m, doy, ndsi]\n    output column: [swe]\n  Sentinel1 model:\n    input columns: [m, doy, grd]\n    output column: [swe]\n  \"\"\"\n  all_mod_file = f\"{github_dir}/data/ready_for_training/modis_all.csv\"\n  modis_all_pd = pd.read_csv(all_mod_file, header=0)\n  print(\"modis_all_size: \", modis_all_pd.shape)\n  print(\"station size: \", station_cell_mapper_pd.shape)\n  print(\"training_feature_pd size: \", training_feature_pd.shape)\n  print(\"testing_feature_pd size: \", testing_feature_pd.shape)\n  \n  ndsi_training_pd = pd.DataFrame(columns=[\"year\", \"m\", \"doy\", \"ndsi\", \"swe\"])\n  modis_all_pd = modis_all_pd.reset_index()\n  for index, row in modis_all_pd.iterrows():\n    dt = datetime.strptime(row['date'], '%Y-%m-%d')\n    month = dt.month\n    year = dt.year\n    doy = dt.timetuple().tm_yday\n    for i in range(3,len(row.index)):\n      cell_id = row.index[i][:-2]\n      ndsi = row.values[i]\n      if cell_id in train_labels_pd.index and row['date'] in train_labels_pd:\n        swe = train_labels_pd.loc[cell_id, row['date']]\n        if not np.isnan(swe):\n          ndsi_training_pd.loc[len(ndsi_training_pd.index)] = [year, month, doy, ndsi, swe]\n  \n  print(ndsi_training_pd.shape)\n  ndsi_training_pd.to_csv(f\"{github_dir}/data/ready_for_training/modis_ready.csv\")\n  \n  all_sentinel1_file = f\"{github_dir}/data/ready_for_training/sentinel1_all.csv\"\n  sentinel1_all_pd = pd.read_csv(all_sentinel1_file, header=0)\n  grd_all_pd = pd.DataFrame(columns=[\"year\", \"m\", \"doy\", \"grd\", \"swe\"])\n  grd_all_pd = grd_all_pd.reset_index()\n  for index, row in sentinel1_all_pd.iterrows():\n    dt = datetime.strptime(row['date'], '%Y-%m-%d')\n    year = dt.year\n    month = dt.month\n    doy = dt.timetuple().tm_yday\n    for i in range(3,len(row.index)):\n      cell_id = row.index[i]\n      grd = row.values[i]\n      if not np.isnan(grd) and cell_id in train_labels_pd.index and row['date'] in train_labels_pd:\n        swe = train_labels_pd.loc[cell_id, row['date']]\n        if not np.isnan(swe):\n          print([month, doy, grd, swe])\n          grd_all_pd = grd_all_pd.append({\"year\": year, \"m\":month, \"doy\": doy, \"grd\": grd, \"swe\": swe}, ignore_index = True)\n  \n  print(grd_all_pd.shape)\n  grd_all_pd.to_csv(f\"{github_dir}/data/ready_for_training/sentinel1_ready.csv\")\n  \n  \nintegrate_modis()\nintegrate_sentinel1()\nprepare_training_csv()\n\n\n  \n  \n  \n",
  "history_output" : "Traceback (most recent call last):\n  File \"data_integration.py\", line 3, in <module>\n    import pandas as pd\nModuleNotFoundError: No module named 'pandas'\n",
  "history_begin_time" : 1645977437341,
  "history_end_time" : 1645977439294,
  "history_notes" : null,
  "history_process" : "u7xh2p",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "qcg3ken9a69",
  "history_input" : "# Deploy model to service\n\nprint(\"deploy model to service\")\n",
  "history_output" : "deploy model to service\n",
  "history_begin_time" : 1645977445591,
  "history_end_time" : 1645977446592,
  "history_notes" : null,
  "history_process" : "2wkl6e",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "0ld354sm3kh",
  "history_input" : "# Predict results using the model\n\nfrom sklearn.ensemble import RandomForestRegressor\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn import metrics \nfrom sklearn import tree\nimport joblib\nimport os\nfrom pathlib import Path\nimport json\nimport geopandas as gpd\nimport geojson\nimport os.path\nimport math\nfrom sklearn.model_selection import RandomizedSearchCV\n\n# read the grid geometry file\n\n\n# read the grid geometry file\nhomedir = os.path.expanduser('~')\nprint(homedir)\ngithub_dir = f\"{homedir}/Documents/GitHub/SnowCast\"\nmodis_test_ready_file = f\"{github_dir}/data/ready_for_training/modis_test_ready.csv\"\nmodis_test_ready_pd = pd.read_csv(modis_test_ready_file, header=0, index_col=0)\n\npd_to_clean = modis_test_ready_pd[[\"year\", \"m\", \"doy\", \"ndsi\", \"swe\", \"station_id\", \"cell_id\"]].dropna()\n\nall_features = pd_to_clean[[\"year\", \"m\", \"doy\", \"ndsi\"]].to_numpy()\nall_labels = pd_to_clean[[\"swe\"]].to_numpy().ravel()\n\ndef evaluate(model, test_features, y_test, model_name):\n    y_predicted = model.predict(test_features)\n    mae = metrics.mean_absolute_error(y_test, y_predicted)\n    mse = metrics.mean_squared_error(y_test, y_predicted)\n    r2 = metrics.r2_score(y_test, y_predicted)\n    rmse = math.sqrt(mse)\n\n    print(\"The {} model performance for testing set\".format(model_name))\n    print(\"--------------------------------------\")\n    print('MAE is {}'.format(mae))\n    print('MSE is {}'.format(mse))\n    print('R2 score is {}'.format(r2))\n    print('RMSE is {}'.format(rmse))\n    \n    return y_predicted\n\nbase_model = joblib.load(f\"{homedir}/Documents/GitHub/snowcast_trained_model/model/wormhole_random_forest_basic.joblib\")\nbasic_predicted_values = evaluate(base_model, all_features, all_labels, \"Base Model\")\n\nbest_random = joblib.load(f\"{homedir}/Documents/GitHub/snowcast_trained_model/model/wormhole_random_forest.joblib\")\nrandom_predicted_values = evaluate(best_random, all_features, all_labels, \"Optimized\")\n",
  "history_output" : "Traceback (most recent call last):\n  File \"service_prediction.py\", line 3, in <module>\n    from sklearn.ensemble import RandomForestRegressor\nModuleNotFoundError: No module named 'sklearn'\n",
  "history_begin_time" : 1645977446839,
  "history_end_time" : 1645977448515,
  "history_notes" : null,
  "history_process" : "i2fynz",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "1rqp5fpgbid",
  "history_input" : "# Train Model\n\nprint(\"Train Models\")\n",
  "history_output" : "Train Models\n",
  "history_begin_time" : 1645977439454,
  "history_end_time" : 1645977440509,
  "history_notes" : null,
  "history_process" : "e8k4wq",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "dkz7oxxxg0l",
  "history_input" : "# Test models\n\n# Random Forest model creation and save to file\n\nfrom sklearn.ensemble import RandomForestRegressor\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn import metrics \nfrom sklearn import tree\nimport joblib\nimport os\nfrom pathlib import Path\nimport json\nimport geopandas as gpd\nimport geojson\nimport os.path\nimport math\nfrom sklearn.model_selection import RandomizedSearchCV\n\n\n# read the grid geometry file\nhomedir = os.path.expanduser('~')\nprint(homedir)\ngithub_dir = f\"{homedir}/Documents/GitHub/SnowCast\"\nmodis_test_ready_file = f\"{github_dir}/data/ready_for_training/modis_train_ready.csv\"\nmodis_test_ready_pd = pd.read_csv(modis_test_ready_file, header=0, index_col=0)\n\npd_to_clean = modis_test_ready_pd[[\"year\", \"m\", \"doy\", \"ndsi\", \"swe\"]].dropna()\n\nall_features = pd_to_clean[[\"year\", \"m\", \"doy\", \"ndsi\"]].to_numpy()\nall_labels = pd_to_clean[[\"swe\"]].to_numpy().ravel()\n\ndef evaluate(model, test_features, y_test, model_name):\n    y_predicted = model.predict(test_features)\n    mae = metrics.mean_absolute_error(y_test, y_predicted)\n    mse = metrics.mean_squared_error(y_test, y_predicted)\n    r2 = metrics.r2_score(y_test, y_predicted)\n    rmse = math.sqrt(mse)\n\n    print(\"The {} model performance for testing set\".format(model_name))\n    print(\"--------------------------------------\")\n    print('MAE is {}'.format(mae))\n    print('MSE is {}'.format(mse))\n    print('R2 score is {}'.format(r2))\n    print('RMSE is {}'.format(rmse))\n    \n    return y_predicted\n\n#base_model = joblib.load(f\"{homedir}/Documents/GitHub/snowcast_trained_model/model/wormhole_random_forest_basic_v2.joblib\")\nbase_model = joblib.load(f\"{homedir}/Documents/GitHub/snowcast_trained_model/model/wormhole_random_forest_basic_v2.joblib\")\nbase_accuracy = evaluate(base_model, all_features, all_labels, \"Base Model\")\n\nbest_random = joblib.load(f\"{homedir}/Documents/GitHub/snowcast_trained_model/model/wormhole_random_forest_v2.joblib\")\nrandom_accuracy = evaluate(best_random, all_features, all_labels, \"Optimized\")\n\n\n\n",
  "history_output" : "Traceback (most recent call last):\n  File \"model_test.py\", line 5, in <module>\n    from sklearn.ensemble import RandomForestRegressor\nModuleNotFoundError: No module named 'sklearn'\n",
  "history_begin_time" : 1645977441312,
  "history_end_time" : 1645977442574,
  "history_notes" : null,
  "history_process" : "h1qp9v",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "v4ftoozfx5x",
  "history_input" : null,
  "history_output" : "/Users/joe/gw-workspace/temp/idjcvRcyvRGH4R217cUR64p5wb.tar is not a regular file or directory",
  "history_begin_time" : 1645977435846,
  "history_end_time" : 1645977436285,
  "history_notes" : null,
  "history_process" : "urd0nk",
  "host_id" : "je29f6",
  "indicator" : "Failed"
},{
  "history_id" : "6mr0lfhxdgv",
  "history_input" : null,
  "history_output" : "/Users/joe/gw-workspace/temp/idjcvRcyvRGH4R217cUR64p5wb.tar is not a regular file or directory",
  "history_begin_time" : 1645977435925,
  "history_end_time" : 1645977436391,
  "history_notes" : null,
  "history_process" : "525l8q",
  "host_id" : "je29f6",
  "indicator" : "Failed"
},{
  "history_id" : "tyjvk2sqzpx",
  "history_input" : "\n\n# reminder that if you are installing libraries in a Google Colab instance you will be prompted to restart your kernal\n\nimport json\nimport pandas as pd\nimport ee\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport os\nimport geopandas as gpd\nimport geojson\nimport numpy as np\nimport os.path\n\ntry:\n    ee.Initialize()\nexcept Exception as e:\n    ee.Authenticate() # this must be run in terminal instead of Geoweaver. Geoweaver doesn't support prompt.\n    ee.Initialize()\n\n# read the grid geometry file\nhomedir = os.path.expanduser('~')\nprint(homedir)\n# read grid cell\ngithub_dir = f\"{homedir}/Documents/GitHub/SnowCast\"\n# read grid cell\nstation_cell_mapper_file = f\"{github_dir}/data/ready_for_training/station_cell_mapping.csv\"\nstation_cell_mapper_df = pd.read_csv(station_cell_mapper_file)\n\n#org_name = 'modis'\n#product_name = f'MODIS/006/MOD10A1'\n#var_name = 'NDSI'\n#column_name = 'mod10a1_ndsi'\n\norg_name = 'sentinel1'\nproduct_name = 'COPERNICUS/S1_GRD'\nvar_name = 'VV'\ncolumn_name = 's1_grd_vv'\n\nall_cell_df = pd.DataFrame(columns = ['date', column_name, 'cell_id', 'latitude', 'longitude'])\n\nfor ind in station_cell_mapper_df.index:\n  \n    try:\n  \t\n      current_cell_id = station_cell_mapper_df['cell_id'][ind]\n      print(\"collecting \", current_cell_id)\n      single_csv_file = f\"{homedir}/Documents/GitHub/SnowCast/data/{org_name}/{column_name}_{current_cell_id}.csv\"\n\n      if os.path.exists(single_csv_file):\n          print(\"exists skipping..\")\n          continue\n\n      longitude = station_cell_mapper_df['lon'][ind]\n      latitude = station_cell_mapper_df['lat'][ind]\n\n      # identify a 500 meter buffer around our Point Of Interest (POI)\n      poi = ee.Geometry.Point(longitude, latitude).buffer(1)\n\n      viirs = ee.ImageCollection(product_name) \\\n          \t.filterDate('2013-01-01','2021-12-31') \\\n            .filterBounds(poi) \\\n          \t.filter(ee.Filter.listContains('transmitterReceiverPolarisation', 'VV')) \\\n      \t\t.select('VV')\n      \n      def poi_mean(img):\n          reducer = img.reduceRegion(reducer=ee.Reducer.mean(), geometry=poi)\n          mean = reducer.get(var_name)\n          return img.set('date', img.date().format()).set(column_name,mean)\n\n      poi_reduced_imgs = viirs.map(poi_mean)\n\n      nested_list = poi_reduced_imgs.reduceColumns(ee.Reducer.toList(2), ['date',column_name]).values().get(0)\n\n      # dont forget we need to call the callback method \"getInfo\" to retrieve the data\n      df = pd.DataFrame(nested_list.getInfo(), columns=['date',column_name])\n\n      df['date'] = pd.to_datetime(df['date'])\n      df = df.set_index('date')\n\n      df['cell_id'] = current_cell_id\n      df['latitude'] = latitude\n      df['longitude'] = longitude\n      df.to_csv(single_csv_file)\n\n      df_list = [all_cell_df, df]\n      all_cell_df = pd.concat(df_list) # merge into big dataframe\n      \n    except Exception as e:\n      \n      print(e)\n      pass\n    \nall_cell_df.to_csv(f\"{homedir}/Documents/GitHub/SnowCast/data/{org_name}/{column_name}.csv\")  \n\n\n",
  "history_output" : "  File \"data_gee_sentinel1_station_only.py\", line 62\n    .filterDate('2013-01-01','2021-12-31') \n    ^\nIndentationError: unexpected indent\n",
  "history_begin_time" : 1645977435540,
  "history_end_time" : 1645977436722,
  "history_notes" : null,
  "history_process" : "7temiv",
  "host_id" : "je29f6",
  "indicator" : "Done"
},{
  "history_id" : "ywnxxbw70jp",
  "history_input" : "import json\nimport pandas as pd\nimport ee\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport os\nimport geopandas as gpd\nimport geojson\nimport numpy as np\nimport os.path\nimport math\n\n#pd.set_option('display.max_columns', None)\n\n# read the grid geometry file\nhomedir = os.path.expanduser('~')\nprint(homedir)\ngithub_dir = f\"{homedir}/Documents/GitHub/SnowCast\"\n# read grid cell\ngridcells_file = f\"{github_dir}/data/snowcast_provided/grid_cells.geojson\"\nmodel_dir = f\"{github_dir}/model/\"\ntraining_feature_file = f\"{github_dir}/data/snowcast_provided/ground_measures_train_features.csv\"\ntesting_feature_file = f\"{github_dir}/data/snowcast_provided/ground_measures_test_features.csv\"\ntrain_labels_file = f\"{github_dir}/data/snowcast_provided/train_labels.csv\"\nground_measure_metadata_file = f\"{github_dir}/data/snowcast_provided/ground_measures_metadata.csv\"\n\ngridcells = geojson.load(open(gridcells_file))\ntraining_df = pd.read_csv(training_feature_file, header=0)\ntesting_df = pd.read_csv(testing_feature_file, header=0)\nground_measure_metadata_df = pd.read_csv(ground_measure_metadata_file, header=0)\ntrain_labels_df = pd.read_csv(train_labels_file, header=0)\n\nprint(\"training: \", training_df.head())\nprint(\"testing: \", testing_df.head())\nprint(\"ground measure metadata: \", ground_measure_metadata_df.head())\nprint(\"training labels: \", train_labels_df.head())\n\nready_for_training_folder = f\"{github_dir}/data/ready_for_training/\"\n\ndef calculateDistance(lat1, lon1, lat2, lon2):\n    lat1 = float(lat1)\n    lon1 = float(lon1)\n    lat2 = float(lat2)\n    lon2 = float(lon2)\n    return math.sqrt((lat1-lat2)**2 + (lon1-lon2)**2)\n  \n# prepare the training data\n\nstation_cell_mapper_df = pd.DataFrame(columns = [\"station_id\", \"cell_id\", \"lat\", \"lon\"])\n\nground_measure_metadata_df = ground_measure_metadata_df.reset_index()  # make sure indexes pair with number of rows\nfor index, row in ground_measure_metadata_df.iterrows():\n  \t\n    print(row['station_id'], row['name'], row['latitude'], row['longitude'])\n    station_lat = row['latitude']\n    station_lon = row['longitude']\n    \n    shortest_dis = 999\n    associated_cell_id = None\n    associated_lat = None\n    associated_lon = None\n    \n    for idx,cell in enumerate(gridcells['features']):\n    \n      current_cell_id = cell['properties']['cell_id']\n\n      #print(\"collecting \", current_cell_id)\n      cell_lon = np.unique(np.ravel(cell['geometry']['coordinates'])[0::2]).mean()\n      cell_lat = np.unique(np.ravel(cell['geometry']['coordinates'])[1::2]).mean()\n\n      dist = calculateDistance(station_lat, station_lon, cell_lat, cell_lon)\n\n      if dist < shortest_dis:\n        associated_cell_id = current_cell_id\n        shortest_dis = dist\n        associated_lat = cell_lat\n        associated_lon = cell_lon\n    \n    station_cell_mapper_df.loc[len(station_cell_mapper_df.index)] = [row['station_id'], associated_cell_id, associated_lat, associated_lon]\n    \nprint(station_cell_mapper_df.head())\nstation_cell_mapper_df.to_csv(f\"{ready_for_training_folder}station_cell_mapping.csv\")\n    \n\n\n      \n",
  "history_output" : "rm: cannot remove '/home/zsun/idjcvRcyvRGH4R217cUR64p5wb.tar': No such file or directory\nTraceback (most recent call last):\n  File \"data_associate_station_grid_cell.py\", line 2, in <module>\nModuleNotFoundError: No module named 'pandas'\nError in sys.excepthook:\nTraceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/apport_python_hook.py\", line 76, in apport_excepthook\n    binary = os.path.realpath(os.path.join(os.getcwd(), sys.argv[0]))\nFileNotFoundError: [Errno 2] No such file or directory\n\nOriginal exception was:\nTraceback (most recent call last):\n  File \"data_associate_station_grid_cell.py\", line 2, in <module>\nModuleNotFoundError: No module named 'pandas'\nrm: cannot remove '/home/zsun/gw-workspace/idjcvRcyvRGH4R217cUR64p5wb': No such file or directory\n",
  "history_begin_time" : 1645977432477,
  "history_end_time" : 1645977434913,
  "history_notes" : null,
  "history_process" : "rmxece",
  "host_id" : "je29f6",
  "indicator" : "Done"
}]
